create table visaCard(
ID NUMBER GENERATED BY DEFAULT AS IDENTITY CONSTRAINT PK_visaCard PRIMARY Key,
CARDNAME varchar2(255),
CARDNUMBER varchar2(255),
expireDate Varchar2(255),
SecurityCode number,
userid number Constraint FK_Visa_USer1 REFERENCES USER1(ID) on DElete CASCADE
);

CREATE OR REPLACE PACKAGE  visaCard_PACKAGE AS

    PROCEDURE visaCard_CRUD(P_ACTION in varchar DEFAULT NULL 
    ,P_ID IN NUMBER DEFAULT NULL
    ,P_CARDNAME IN VARCHAR DEFAULT NULL
    ,P_CARDNUMBER IN VARCHAR DEFAULT NULL
    ,P_expireDate IN VARCHAR DEFAULT NULL
    ,P_SecurityCode IN NUMBER DEFAULT NULL
    ,P_USERID IN NUMBER DEFAULT NULL);
    
End visaCard_PACKAGE;



CREATE OR REPLACE PACKAGE BODY visaCard_PACKAGE AS
    
    PROCEDURE visaCard_CRUD(P_ACTION in varchar DEFAULT NULL 
    ,P_ID IN NUMBER DEFAULT NULL
    ,P_CARDNAME IN VARCHAR DEFAULT NULL
    ,P_CARDNUMBER IN VARCHAR DEFAULT NULL
    ,P_expireDate IN VARCHAR DEFAULT NULL
    ,P_SecurityCode IN NUMBER DEFAULT NULL
    ,P_USERID IN NUMBER DEFAULT NULL)
    IS
        visa_all SYS_REFCURSOR;
    BEGIN
        IF P_ACTION = 'INSERT' THEN
            INSERT INTO visaCard VALUES(DEFAULT,P_CARDNAME,P_CARDNUMBER,P_expireDate,P_SecurityCode,P_USERID); 
            COMMIT;
        ELSIF P_ACTION = 'UPDATE' THEN

            UPDATE visaCard SET
                CARDNAME = P_CARDNAME , CARDNUMBER = P_CARDNUMBER,
                EXPIREDATE = P_expireDate , SECURITYCODE = P_SecurityCode,
                USERID = P_USERID
            WHERE ID = P_ID;
            COMMIT;

        ELSIF P_ACTION = 'DELETE' THEN
            DELETE visaCard WHERE ID = P_ID;
            COMMIT;

        ELSIF P_ACTION = 'GETALL' THEN
            OPEN visa_all FOR SELECT * FROM visaCard;
            dbms_sql.return_result(visa_all);

        ELSIF P_ACTION = 'GETBYID' THEN
            OPEN visa_all FOR SELECT * FROM visaCard WHERE ID = P_ID;
            dbms_sql.return_result(visa_all);
        ELSIF P_ACTION = 'GETBYCARDNUMBER' THEN
            OPEN visa_all FOR SELECT * FROM visaCard WHERE CARDNUMBER = P_CARDNUMBER;
            dbms_sql.return_result(visa_all);
        END IF;
    END visaCard_CRUD;

END visaCard_PACKAGE;

