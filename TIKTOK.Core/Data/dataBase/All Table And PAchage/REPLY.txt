Create Table Replay(
 ID NUMBER GENERATED BY DEFAULT AS IDENTITY CONSTRAINT PK_reply PRIMARY Key,
 message Varchar2(255),
 imagepath Varchar2(255),
 videopath Varchar2(255),
 createat date,
 userid NUMBER CONSTRAINT FK_Reply_USERID REFERENCES USER1(ID) ON DELETE CASCADE,
 videoid NUMBER CONSTRAINT FK_video_Reply REFERENCES video(ID) ON DELETE CASCADE
);

CREATE OR REPLACE PACKAGE  Replay_PACKAGE AS

    PROCEDURE Replay_CRUD(P_ACTION in varchar DEFAULT NULL 
    ,P_ID IN NUMBER DEFAULT NULL
    ,P_message IN VARCHAR DEFAULT NULL
    ,P_imagepath IN VARCHAR DEFAULT NULL
    ,P_videopath IN VARCHAR DEFAULT NULL
    ,P_createat IN DATE DEFAULT NULL
    ,P_userid IN NUMBER DEFAULT NULL
    ,P_videoid IN NUMBER DEFAULT NULL);
    
End Replay_PACKAGE;



CREATE OR REPLACE PACKAGE BODY Replay_PACKAGE AS
    
    PROCEDURE Replay_CRUD(P_ACTION in varchar DEFAULT NULL 
    ,P_ID IN NUMBER DEFAULT NULL
    ,P_message IN VARCHAR DEFAULT NULL
    ,P_imagepath IN VARCHAR DEFAULT NULL
    ,P_videopath IN VARCHAR DEFAULT NULL
    ,P_createat IN DATE DEFAULT NULL
    ,P_userid IN NUMBER DEFAULT NULL
    ,P_videoid IN NUMBER DEFAULT NULL)
    IS
        reply_all SYS_REFCURSOR; 
    BEGIN
        EXECUTE IMMEDIATE 'ALTER SESSION SET NLS_DATE_FORMAT=''DD-MON-YYYY HH24:MI:SS''';
        IF P_ACTION = 'INSERT' THEN
            INSERT INTO Replay VALUES(DEFAULT,P_message,P_imagepath,P_videopath,To_DATE(P_createat,'DD-MM-YYYY HH24:MI:SS'),P_userid,P_videoid); 
            COMMIT;
        ELSIF P_ACTION = 'UPDATE' THEN

            UPDATE Replay SET
                message = P_message ,  imagepath =P_imagepath ,
                videopath = P_videopath,
                CREATEAT = To_DATE(P_createat,'DD-MM-YYYY HH24:MI:SS') ,
                USERID = P_userid , VIDEOID = P_videoid
            WHERE ID = P_ID;
            COMMIT;

        ELSIF P_ACTION = 'DELETE' THEN
            DELETE Replay WHERE ID = P_ID;
            COMMIT;

        ELSIF P_ACTION = 'GETALL' THEN
            OPEN reply_all FOR SELECT * FROM Replay;
            dbms_sql.return_result(reply_all);

        ELSIF P_ACTION = 'GETBYID' THEN
            OPEN reply_all FOR SELECT * FROM Replay WHERE ID = P_ID;
            dbms_sql.return_result(reply_all);  
        END IF;
    END Replay_CRUD;

END Replay_PACKAGE;