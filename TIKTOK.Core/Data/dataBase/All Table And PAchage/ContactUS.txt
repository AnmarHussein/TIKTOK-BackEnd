Create table ContactUS (
ID NUMBER GENERATED BY DEFAULT AS IDENTITY CONSTRAINT PK_ContactUS PRIMARY Key,
FullName Varchar2(255) not null,
email Varchar2(255) not null,
Subject Varchar2(255) not null,
Message Varchar2(255) not null,
createAt Date,
DeleteAt Date ,
important number(1) DEFAULT 0 not null
);
alter table ContactUS Add reademail number(1) DEFAULT 0 not null;
CREATE OR REPLACE PACKAGE  ContactUS_PACKAGE AS

    PROCEDURE ContactUSInsert(
    P_FullName IN VARCHAR DEFAULT NULL
    ,P_email IN VARCHAR DEFAULT NULL
    ,P_Subject IN VARCHAR DEFAULT NULL
    ,P_Message IN VARCHAR DEFAULT NULL
    ,P_createAt in date DEFAULT NULL
    );
    
    PROCEDURE ContactUSImportant(P_ID in number,P_important in number DEFAULT 0);

    PROCEDURE ContactUSGetAll;
    
    PROCEDURE ContactUSTrash(P_ID in number);
    PROCEDURE ContactUSTrashRemove(P_ID in number);
    PROCEDURE ContactUSReadEmail(P_ID in number);
    PROCEDURE ContactUSGetById(P_ID in number);
    
End ContactUS_PACKAGE;



CREATE OR REPLACE PACKAGE BODY ContactUS_PACKAGE AS
    
    PROCEDURE ContactUSInsert(
    P_FullName IN VARCHAR DEFAULT NULL
    ,P_email IN VARCHAR DEFAULT NULL
    ,P_Subject IN VARCHAR DEFAULT NULL
    ,P_Message IN VARCHAR DEFAULT NULL
    ,P_createAt in date DEFAULT NULL
    )
    IS
    BEGIN
        EXECUTE IMMEDIATE 'ALTER SESSION SET NLS_DATE_FORMAT=''DD-MON-YYYY HH24:MI:SS''';
        INSERT Into ContactUS(FULLNAME,EMAIL,SUBJECT,MESSAGE,CREATEAT) 
        VALUES(P_FullName,P_email,P_Subject,P_Message,To_DATE(P_createAt,'DD-MM-YYYY HH24:MI:SS'));
        commit;
    End ContactUSInsert; 
    
    PROCEDURE ContactUSImportant(P_ID in number,P_important in number DEFAULT 0) IS
    Begin 
        Update ContactUS Set important = P_important Where id = P_ID;
        commit;
    End ContactUSImportant;
    
    
    
    PROCEDURE ContactUSGetAll IS
        cont_all SYS_REFCURSOR;
    Begin 
        OPEN cont_all FOR SELECT * FROM ContactUS Order By readEmail ASC ;
        dbms_sql.return_result(cont_all);
    End ContactUSGetAll;
    
    
    PROCEDURE ContactUSTrash(P_ID in number) IS
    Begin 
        EXECUTE IMMEDIATE 'ALTER SESSION SET NLS_DATE_FORMAT=''DD-MON-YYYY HH24:MI:SS''';
        Update ContactUS Set DeleteAt = To_DATE(SysDate,'DD-MM-YYYY HH24:MI:SS'),important=0  Where id = P_ID;
        commit;
    End ContactUSTrash;
    
    PROCEDURE ContactUSTrashRemove(P_ID in number) IS
    Begin 
        Update ContactUS Set DeleteAt = null  Where id = P_ID;
        commit;
    End ContactUSTrashRemove;
    
    PROCEDURE ContactUSReadEmail(P_ID in number) IS
    Begin 
        Update ContactUS Set READEMAIL = 1  Where id = P_ID;
        commit;
    End ContactUSReadEmail;
    
    PROCEDURE ContactUSGetById(P_ID in number) IS
    cont_all SYS_REFCURSOR;
    Begin 
        OPEN cont_all FOR SELECT * FROM ContactUS Where id=P_ID ;
        dbms_sql.return_result(cont_all);
    End ContactUSGetById;
END ContactUS_PACKAGE;
