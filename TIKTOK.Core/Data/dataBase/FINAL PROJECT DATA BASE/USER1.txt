

Create Table User1(
 ID NUMBER GENERATED BY DEFAULT AS IDENTITY CONSTRAINT PK_user PRIMARY Key,
 Fullname Varchar2(255),
 UserName Varchar2(255),
 Password Varchar2(255),
 Email Varchar2(255),
 title VARCHAR2(255),
 Imagepath VARCHAR2(255),
 Bdate Date,
 isblock number(1) DEFAULT 0,
 confirmEmail number(1) DEFAULT 0,
 roleid Number Constraint Fk_Role_User REFERENCES Role(ID) on DELETE CASCADE,
 genderid Number Constraint Fk_gender_User REFERENCES Gender(ID) on DELETE CASCADE
 );


CREATE OR REPLACE PACKAGE  User1_PACKAGE AS

    PROCEDURE User1_CRUD(P_ACTION in varchar DEFAULT NULL 
    ,P_ID IN NUMBER DEFAULT NULL
    ,P_FULLNAME IN VARCHAR DEFAULT NULL
    ,P_UserName IN VARCHAR DEFAULT NULL
    ,P_Password IN VARCHAR DEFAULT NULL
    ,P_Email IN VARCHAR DEFAULT NULL
    ,P_title IN VARCHAR DEFAULT NULL
    ,P_Imagepath IN VARCHAR DEFAULT NULL
    ,P_Bdate IN DATE DEFAULT NULL
    ,P_isblock IN NUMBER DEFAULT 0
    ,P_confirmEmail IN NUMBER DEFAULT 0
    ,P_ROLEID IN NUMBER DEFAULT NULL
    ,P_genderid IN NUMBER DEFAULT NULL
    );
End USER1_PACKAGE;



CREATE OR REPLACE PACKAGE BODY User1_PACKAGE AS
    
    PROCEDURE User1_CRUD(P_ACTION in varchar DEFAULT NULL 
    ,P_ID IN NUMBER DEFAULT NULL
    ,P_FULLNAME IN VARCHAR DEFAULT NULL
    ,P_UserName IN VARCHAR DEFAULT NULL
    ,P_Password IN VARCHAR DEFAULT NULL
    ,P_Email IN VARCHAR DEFAULT NULL
    ,P_title IN VARCHAR DEFAULT NULL
    ,P_Imagepath IN VARCHAR DEFAULT NULL
    ,P_Bdate IN DATE DEFAULT NULL
    ,P_isblock IN NUMBER DEFAULT 0
    ,P_confirmEmail IN NUMBER DEFAULT 0
    ,P_ROLEID IN NUMBER DEFAULT NULL
    ,P_genderid IN NUMBER DEFAULT NULL
    )
    IS
        user1_all SYS_REFCURSOR;
    BEGIN
        EXECUTE IMMEDIATE 'ALTER SESSION SET NLS_DATE_FORMAT=''DD-MON-YYYY HH24:MI:SS''';
        IF P_ACTION = 'INSERT' THEN
            INSERT INTO USER1 VALUES(DEFAULT,P_FULLNAME,P_UserName,P_Password,P_Email,P_title,P_Imagepath,
                                    To_DATE(P_bdate,'DD-MM-YYYY HH24:MI:SS'),P_isblock,P_confirmEmail,P_ROLEID,P_genderid); 
            COMMIT;
        ELSIF P_ACTION = 'UPDATE' THEN

            UPDATE USER1 SET
                FULLNAME = P_FULLNAME ,  PASSWORD = P_PASSWORD,
                EMAIL = P_EMAIL , USERNAME = P_USERNAME ,  TITLE=P_title,
                Imagepath = P_Imagepath , BDATE = To_DATE(P_bdate,'DD-MM-YYYY HH24:MI:SS'),
                genderid = P_genderid , ISBLOCK = P_isblock, confirmEmail= P_confirmEmail,
                ROLEID = P_ROLEID   
            WHERE ID = P_ID;
            COMMIT;

        ELSIF P_ACTION = 'DELETE' THEN
            DELETE USER1 WHERE ID = P_ID;
            COMMIT;

        ELSIF P_ACTION = 'GETALL' THEN
            OPEN user1_all FOR SELECT * FROM USER1;
            dbms_sql.return_result(user1_all);

        ELSIF P_ACTION = 'GETBYID' THEN
            OPEN user1_all FOR SELECT * FROM USER1 WHERE ID = P_ID;
            dbms_sql.return_result(user1_all);
        ELSIF P_ACTION = 'GETBYNAME' THEN
            OPEN user1_all FOR SELECT * FROM USER1 WHERE USERNAME = P_USERNAME;
            dbms_sql.return_result(user1_all);
        END IF;
    END User1_CRUD;
    
END User1_PACKAGE;













